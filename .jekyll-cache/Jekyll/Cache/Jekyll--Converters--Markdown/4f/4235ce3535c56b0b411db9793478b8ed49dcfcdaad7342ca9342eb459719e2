I"‹"<p>Lo primero que debemos hacer al explorar una m√°quina es identificar el sistema operativo y cualquier servicio disponible que pueda estar ejecut√°ndose. Un servicio es una aplicaci√≥n 
ejecutando en un ordenador que realiza funciones √∫tiles para otros ordenadores. Las m√°quinas especializadadas en ejecutar servicios se conocen como ‚Äúservidores‚Äù.<br />
En lugar de realizar las acciones esperadas de ese servicio, a nosotros nos interesa obligar al servicio a hacer algo que nos ayude (como ejecutar un comando).</p>

<p>A los ordenadores se les asigna una direcci√≥n IP, que les permite ser identificados en la red de forma √∫nica. A los servicios, que ejecutan en esos ordenadores, se les asigna un
n√∫mero de puerto para hacerlos accesibles. Ese n√∫mero estar√° entre el 1 y el 65535, aunque los n√∫meros del 1 al 1023 se reservan a servicios privilegiados. El puerto 0 pertenece a
la navegaci√≥n TCP/IP y no se usa en los mensajes TCP o UDP. Si algo intenta trabajar en el puerto 0, se le pasar√° al siguiente puerto libre a partir del 1024.</p>

<p>Para acceder a un servicio de forma remota, debemos conectarnos con la IP y puerto adecuados y utilizar un lenguaje que el servicio pueda entender. Ya que examinar los 65535 puertos
de forma manual es pr√°cticamente impensable, hay herramientas que lo hacen por nosotros. Como <em>Network Mapper</em> (Nmap).</p>

<h3 id="nmap"><a href="#header-2"></a>Nmap</h3>

<p>Un escaneo b√°sico con <code class="language-plaintext highlighter-rouge">nmap</code> ser√≠a algo as√≠ como <code class="language-plaintext highlighter-rouge">nmap &lt;direcci√≥n_IP&gt;</code>. Esto s√≥lo escanear√≠a los 1000 puertos m√°s comunes y nos devolver√≠a aquellos abiertos y su servicio m√°s com√∫n.
Por defecto, el escaneo ser√≠a √∫nicamente de los puertos TCP.<br />
En cuanto al estado, no siempre es <strong>abierto</strong> o <strong>cerrado</strong>; tambi√©n podr√≠amos encontrar un estado <strong>filtrado</strong>. Este se da cuando un cortafuegos s√≥lo permite el acceso desde 
direcciones determinadas.</p>

<p>Con la experiencia notaremos que algunos puertos, como el 3389 (Servicios de Escritorio Remoto), son un indicador del sistema operativo de la m√°quina objetivo.</p>

<p>En un escaneo m√°s avanzado, podr√≠amos usar par√°metros como <code class="language-plaintext highlighter-rouge">-sC</code> para especificar que <code class="language-plaintext highlighter-rouge">nmap</code> deber√≠a probar sus scripts para obtener informaci√≥n m√°s detallada; <code class="language-plaintext highlighter-rouge">-sV</code> para realizar
un escaneo de versi√≥n, cuya funci√≥n es identificar el protocolo del servicio, el nombre de la aplicaci√≥n y la versi√≥n; o <code class="language-plaintext highlighter-rouge">-p-</code> para escanear el rango completo (65535) de puertos
TCP.<br />
De esta manera, podemos llegar a conocer la versi√≥n del sistema operativo objetivo. Por ejemplo mediante la versi√≥n de los paquetes que se ejecutan en un puerto, pese a que no es 
100% confiable.</p>

<p>El par√°metro <code class="language-plaintext highlighter-rouge">-sC</code> hace que <code class="language-plaintext highlighter-rouge">nmap</code> devuelva la p√°gina de cabezera y de t√≠tulo del servidor, que nos pueden brindar mucha informaci√≥n al abrirlas en el navegador. En ocasiones, 
nos convendr√° que <code class="language-plaintext highlighter-rouge">nmap</code> ejecute un <em>script</em> en concreto; lo que podemos hacer mediante:<br />
<code class="language-plaintext highlighter-rouge">nmap --script &lt;nombre del script&gt; -p&lt;puerto&gt; &lt;_host_&gt;</code></p>

<h3 id="servicios-de-ataque-de-redes"><a href="#header-3"></a>Servicios de ataque de redes</h3>

<h4 id="banner-grabbing"><a href="#header-4"></a><em>Banner Grabbing</em></h4>

<p>Como ya hemos visto anteriormente, leer la cartelera de un servicio es una buena t√©cnica para identificarlo. Esto se puede hacer con <code class="language-plaintext highlighter-rouge">nmap -sV --script=banner &lt;objetivo&gt;</code><br />
o como ya vimos con <code class="language-plaintext highlighter-rouge">Netcat</code>: <code class="language-plaintext highlighter-rouge">nc -nv &lt;direcci√≥n_ip&gt; &lt;puerto&gt;</code><br />
o <code class="language-plaintext highlighter-rouge">nmap -sV --script=banner -p21 &lt;direcci√≥n_ip&gt;/&lt;puerto&gt;</code></p>

<h4 id="ftp"><a href="#header-5"></a>FTP</h4>

<p>Este servicio suele contener informaci√≥n interesante. Un escaneo <code class="language-plaintext highlighter-rouge">Nmap</code> del puerto 21 (FTP) puede revelar la versi√≥n instalada de ‚Äúvsftpd‚Äù y adem√°s nos dice que la autenticaci√≥n
an√≥nima est√° activada y que un directorio <code class="language-plaintext highlighter-rouge">pub</code>.<br />
Una vez escaneado podemos conectarnos al servicio mediante <code class="language-plaintext highlighter-rouge">ftp -p &lt;direcci√≥n_ip&gt;</code> .</p>

<p>FTP nos permite usar comandos comunes como <code class="language-plaintext highlighter-rouge">cd</code> y <code class="language-plaintext highlighter-rouge">ls</code> y nos permite descargar archivos usando el comando <code class="language-plaintext highlighter-rouge">get</code>. Podemos inspeccionar lo descargado con <code class="language-plaintext highlighter-rouge">cat</code>.</p>

<h4 id="smb"><a href="#header-6"></a>SMB</h4>

<p>El Bloque de Mensajes del Servidor (SMB) es un protocolo de Windows que da vectores para movimineto lateral y vertical. Datos sensibles, como las credenciales, pueden estar en 
los archivos compartidos de la red y algunas versiones de SMB pueden ser vulnerables a exploits RCE (como <em>EternalBlue</em>). Es crucial enumerar cuidadosamente esta superf√≠cie de
ataque potencial. <code class="language-plaintext highlighter-rouge">Nmap</code> tiene diversos <em>scripts</em> para enumerar SMB, como <code class="language-plaintext highlighter-rouge">nmap --script smb-os-discovery.nse -p445 &lt;direcci√≥n_ip&gt;</code>.</p>

<p>El marco de trabajo <em>Metasploit</em> tiene diversos m√≥dulos para validar y explotar la vulnerabilidad de <em>EternalBlue</em>.</p>

<h5 id="shares"><a href="#header-7"></a><em>Shares</em></h5>

<p>SMB permite a los usuarios y administradores compartir carpetas y hacerlas accesibles remotamente para otros usuarios. A menudo esas carpetas contienen informaci√≥n sensible. 
Una herramienta que enumera e interact√∫a con lo compartido por SMB es <code class="language-plaintext highlighter-rouge">smbclient</code>. Con el par√°metro -L, especificamos que queremos una lista de lo compartido y disponible en el 
anfitri√≥n remoto. Y con -N suprimimos la solicitud de contrase√±a: 
<code class="language-plaintext highlighter-rouge">smbclient -N -L \\\\&lt;direcci√≥n_IP&gt;</code></p>

<p>Luego, podemos intentar conectarnos:<br />
<code class="language-plaintext highlighter-rouge">smbclient \\\\&lt;direcci√≥n_ip&gt;\\&lt;nombre_compartici√≥n&gt;</code><br />
Es com√∫n probar como invitado (<em>guest</em>) si no disponemos de credenciales o, en caso contrario, con:<br />
<code class="language-plaintext highlighter-rouge">smbclient -U &lt;usuario&gt; \\\\&lt;direcci√≥n_ip&gt;\\&lt;nombre_compartici√≥n&gt;</code><br />
Una vez dentro, al igual que con FTP, podemos usar comandos como <code class="language-plaintext highlighter-rouge">cd</code>, <code class="language-plaintext highlighter-rouge">ls</code> o <code class="language-plaintext highlighter-rouge">get</code> para movernos y descargar archivos.</p>

<h3 id="snmp"><a href="#header-8"></a>SNMP</h3>

<p>Las cadenas de comunidad de SNMP (<em>Simple Network Management Protocol</em>) nos dan informaci√≥n y estad√≠sticas acerca de un dispositivo o <em>router</em>, con el objetivo de ayudarnos a ganar
acceso a √©l. En las versiones 1 y 2c de SNMP, se accede mediante una cadena de texto plano; por lo que, si sabemos el nombre, podemos acceder. A partir de la versi√≥n 3 de SNMP nos
encontramos con encriptaci√≥n y autenticaci√≥n, lo cual dificulta la tarea. Pero examinando los par√°metros del proceso podemos encontrarnos credenciales usadas en la l√≠nea de comandos.
Credenciales que quiz√° podamos reutilizar para otros servicios del entorno empresarial. Otras informaciones de inter√©s tambi√©n se nos podr√≠an revelar con este m√©todo.</p>

<p><code class="language-plaintext highlighter-rouge">snmpwalk -v 2c -c public &lt;direcci√≥n_ip&gt; &lt;cadena de comunidad&gt;</code><br />
<code class="language-plaintext highlighter-rouge">snmpwalk -v 2c -c private &lt;direcci√≥n_ip&gt;</code></p>

<p>Herramientas como <code class="language-plaintext highlighter-rouge">onesixtyone</code> se pueden usar para encontrar la cadena mediante un diccionario de cadenas comunes (como el incluido en el GitHub de la herramienta):<br />
<code class="language-plaintext highlighter-rouge">onesixstone -c &lt;archivo_diccionario&gt; &lt;direcci√≥n_ip&gt;</code></p>
:ET